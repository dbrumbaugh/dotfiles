#!/usr/bin/env ksh93

typeset -E used total perc

line=$(free -m | gsed -n '2{p;q}')
used=$(echo $line | awk '{print $3}')
total=$(echo $line | awk '{print $2}')

perc=$(( used / total * 100 ))

if (( perc <= 50 )); then
    color="^C2^"
elif (( perc <= 80 )); then
    color="^C3^"
else
    color="^C1^"
fi

used_gb=$(( used / 1024 ))
avail_gb=$(( total / 1024 ))


temp=$(sysctl hw.sensors.cpu0.temp0 | cut -f 1 -d " " | cut -f 2 -d "=")
if (( temp <= 50 )); then
    tcolor="^C2^ "
elif (( temp <= 80 )); then
    tcolor="^C3^ "
elif (( temp <= 90 )); then
    tcolor="^C3^ "
else
    tcolor="^C1^ "
fi

cpu="$(systat -B cpu | tail -4 | tr -d '%' | awk '{s+=$7} END{ print (400-s)/4 }')"

if (( cpu <= 40 )); then
    cpu_icon="^C2^ "
elif (( cpu <= 80 )); then
    cpu_icon="^C3^ "
else
    cpu_icon="^C1^ "
fi

printf "%s %.1f %s %.1f %s %d\n" $cpu_icon $cpu $color $perc $tcolor $temp
